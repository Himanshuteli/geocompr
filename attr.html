<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Geocomputation with R</title>
  <meta name="description" content="Geocomputation with R">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Geocomputation with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://robinlovelace.net/geocompr" />
  
  
  <meta name="github-repo" content="Robinlovelace/geocompr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Geocomputation with R" />
  
  
  

<meta name="author" content="Robin Lovelace">
<meta name="author" content="Jakub Nowosad">


<meta name="date" content="2017-06-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="spatial-class.html">
<link rel="next" href="spatial-data-operations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<link href="libs/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-0.7.7/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="libs/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="libs/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="libs/leaflet-binding-1.1.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-1.1.0/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99618359-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Geocomputation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#development"><i class="fa fa-check"></i>Development</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#why-geocomputation-with-r"><i class="fa fa-check"></i><b>1.1</b> Why Geocomputation with R?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#rs-spatial-ecosystem"><i class="fa fa-check"></i><b>1.2</b> R’s spatial ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="spatial-class.html"><a href="spatial-class.html"><i class="fa fa-check"></i><b>2</b> Simple features and plots</a><ul>
<li class="chapter" data-level="" data-path="spatial-class.html"><a href="spatial-class.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="spatial-class.html"><a href="spatial-class.html#intro-sf"><i class="fa fa-check"></i><b>2.1</b> An introduction to Simple Features</a><ul>
<li class="chapter" data-level="2.1.1" data-path="spatial-class.html"><a href="spatial-class.html#exercises"><i class="fa fa-check"></i><b>2.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="spatial-class.html"><a href="spatial-class.html#why-simple-features"><i class="fa fa-check"></i><b>2.2</b> Why Simple Features?</a></li>
<li class="chapter" data-level="2.3" data-path="spatial-class.html"><a href="spatial-class.html#basic-map"><i class="fa fa-check"></i><b>2.3</b> Basic map making</a><ul>
<li class="chapter" data-level="2.3.1" data-path="spatial-class.html"><a href="spatial-class.html#challenge"><i class="fa fa-check"></i><b>2.3.1</b> Challenge</a></li>
<li class="chapter" data-level="2.3.2" data-path="spatial-class.html"><a href="spatial-class.html#further-work"><i class="fa fa-check"></i><b>2.3.2</b> Further work</a></li>
<li class="chapter" data-level="2.3.3" data-path="spatial-class.html"><a href="spatial-class.html#exercises-1"><i class="fa fa-check"></i><b>2.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="spatial-class.html"><a href="spatial-class.html#sfg"><i class="fa fa-check"></i><b>2.4</b> Simple feature geometries, collections and data frames</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-class.html"><a href="spatial-class.html#simple-feature-geometries"><i class="fa fa-check"></i><b>2.5</b> Simple feature geometries</a></li>
<li class="chapter" data-level="2.6" data-path="spatial-class.html"><a href="spatial-class.html#raster-data"><i class="fa fa-check"></i><b>2.6</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="attr.html"><a href="attr.html"><i class="fa fa-check"></i><b>3</b> Attribute data operations</a><ul>
<li class="chapter" data-level="" data-path="attr.html"><a href="attr.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="attr.html"><a href="attr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="attr.html"><a href="attr.html#base-vs-data.table-vs-dplyr"><i class="fa fa-check"></i><b>3.2</b> Base vs data.table vs dplyr</a></li>
<li class="chapter" data-level="3.3" data-path="attr.html"><a href="attr.html#attribute-subsetting"><i class="fa fa-check"></i><b>3.3</b> Attribute subsetting</a><ul>
<li class="chapter" data-level="3.3.1" data-path="attr.html"><a href="attr.html#exercises-2"><i class="fa fa-check"></i><b>3.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="attr.html"><a href="attr.html#attribute-data-aggregation"><i class="fa fa-check"></i><b>3.4</b> Attribute data aggregation</a><ul>
<li class="chapter" data-level="3.4.1" data-path="attr.html"><a href="attr.html#exercises-3"><i class="fa fa-check"></i><b>3.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="attr.html"><a href="attr.html#attribute-data-joining"><i class="fa fa-check"></i><b>3.5</b> Attribute data joining</a><ul>
<li class="chapter" data-level="3.5.1" data-path="attr.html"><a href="attr.html#left-joins"><i class="fa fa-check"></i><b>3.5.1</b> Left joins</a></li>
<li class="chapter" data-level="3.5.2" data-path="attr.html"><a href="attr.html#right-joins"><i class="fa fa-check"></i><b>3.5.2</b> Right joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="attr.html"><a href="attr.html#inner-joins"><i class="fa fa-check"></i><b>3.5.3</b> Inner joins</a></li>
<li class="chapter" data-level="3.5.4" data-path="attr.html"><a href="attr.html#semi-joins"><i class="fa fa-check"></i><b>3.5.4</b> Semi joins</a></li>
<li class="chapter" data-level="3.5.5" data-path="attr.html"><a href="attr.html#anti-joins"><i class="fa fa-check"></i><b>3.5.5</b> Anti joins</a></li>
<li class="chapter" data-level="3.5.6" data-path="attr.html"><a href="attr.html#full-joins"><i class="fa fa-check"></i><b>3.5.6</b> Full joins</a></li>
<li class="chapter" data-level="3.5.7" data-path="attr.html"><a href="attr.html#exercises-4"><i class="fa fa-check"></i><b>3.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="attr.html"><a href="attr.html#attribute-data-creation"><i class="fa fa-check"></i><b>3.6</b> Attribute data creation</a><ul>
<li class="chapter" data-level="3.6.1" data-path="attr.html"><a href="attr.html#exercises-5"><i class="fa fa-check"></i><b>3.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="attr.html"><a href="attr.html#removing-spatial-information"><i class="fa fa-check"></i><b>3.7</b> Removing spatial information</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html"><i class="fa fa-check"></i><b>4</b> Spatial data operations</a><ul>
<li class="chapter" data-level="" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#spatial-subsetting"><i class="fa fa-check"></i><b>4.2</b> Spatial subsetting</a><ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#spatial-clipping"><i class="fa fa-check"></i><b>4.2.1</b> Spatial clipping</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#exercises-6"><i class="fa fa-check"></i><b>4.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#spatial-data-aggregation"><i class="fa fa-check"></i><b>4.3</b> Spatial data aggregation</a></li>
<li class="chapter" data-level="4.4" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#spatial-data-joining"><i class="fa fa-check"></i><b>4.4</b> Spatial data joining</a></li>
<li class="chapter" data-level="4.5" data-path="spatial-data-operations.html"><a href="spatial-data-operations.html#spatial-data-creation"><i class="fa fa-check"></i><b>4.5</b> Spatial data creation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="read-write.html"><a href="read-write.html"><i class="fa fa-check"></i><b>5</b> Geographic data I/O</a><ul>
<li class="chapter" data-level="5.1" data-path="read-write.html"><a href="read-write.html#data-input-i"><i class="fa fa-check"></i><b>5.1</b> Data Input (I)</a></li>
<li class="chapter" data-level="5.2" data-path="read-write.html"><a href="read-write.html#data-output-o"><i class="fa fa-check"></i><b>5.2</b> Data output (O)</a></li>
<li class="chapter" data-level="5.3" data-path="read-write.html"><a href="read-write.html#file-formats"><i class="fa fa-check"></i><b>5.3</b> File formats</a></li>
<li class="chapter" data-level="5.4" data-path="read-write.html"><a href="read-write.html#visual-outputs"><i class="fa fa-check"></i><b>5.4</b> Visual outputs</a></li>
<li class="chapter" data-level="5.5" data-path="read-write.html"><a href="read-write.html#exercises-7"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
<li class="divider"></li>
<li><a href="http://robinlovelace.net/">Robin Lovelace</a></li>
<li><a href="https://nowosad.github.io/">Jakub Nowosad</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Geocomputation with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="attr" class="section level1">
<h1><span class="header-section-number">3</span> Attribute data operations</h1>
<div id="prerequisites-1" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<ul>
<li>This chapter requires <strong>tidyverse</strong> and <strong>sf</strong>:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<ul>
<li>You must have loaded the <code>world</code> and <code>worldbank_df</code> data from the <strong>spData</strong> package:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spData)
<span class="kw">data</span>(<span class="st">&quot;world&quot;</span>)
<span class="kw">data</span>(<span class="st">&quot;worldbank_df&quot;</span>)</code></pre></div>
</div>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>Attribute data is non-geographic information associated with geographical data. In the context of simple features, introduced in the previous chapter, this means a tabular data joined onto the <code>geometry</code> variables of <code>sf</code> objects. This structure enables multiple columns to represent a range of attributes for thousands of features (one row per feature).</p>
<p>There is a strong overlap between geographical and non-geographical operations: non-spatial subset, aggregate and join operations each have their geographical equivalents. For this reason this chapter provides the foundation for next (chapter <a href="spatial-data-operations.html#spatial-data-operations">4</a>). The two chapters share the same structure and input data; it is recommended that they are read together.</p>
<p>The non-spatial versions of these methods are common and easy to understand with R, so they are covered first. The methods are largely cross-transferable to the trickier tasks of spatial data operations, so pay attention!</p>
<p>Simple features are represented as objects, such as <code>world</code>, with class <code>sf</code> in the <strong>sf</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(world)
<span class="co">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></code></pre></div>
<p>The output shows that <code>sf</code> objects have two classes (<code>sf</code> and <code>data.frame</code>), meaning that are essentially data frames. Using data frames, the basic class used for data analysis in R, particularly within <a href="http://tidyverse.org/">the <strong>tidyverse</strong> package ecosystem</a>, has many advantages when it comes to attribute data operations. It means that all the accumulated know-how in the R community for handling data frames to be applied to geographic data which contain attributes.</p>
<p>This ‘world’ dataset contains 10 non-geographical variables (and one geometry column) with data for almost 200 countries, as can be ascertained using base functions for working with tabular data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(world) <span class="co"># it is a 2 dimensional object, with rows and columns</span>
<span class="co">#&gt; [1] 177  11</span>
<span class="kw">nrow</span>(world) <span class="co"># how many rows?</span>
<span class="co">#&gt; [1] 177</span>
<span class="kw">ncol</span>(world) <span class="co"># how many columns?</span>
<span class="co">#&gt; [1] 11</span></code></pre></div>
<p>Extracting the attribute data of an <code>sf</code> object is the same as removing the geometry column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world_df =<span class="st"> </span>world
<span class="kw">st_geometry</span>(world_df) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">class</span>(world_df)
<span class="co">#&gt; [1] &quot;data.frame&quot;</span></code></pre></div>
<p>This can be useful if the geometry column causes problem, e.g. by occupying large amounts of RAM. However, for most cases there is no harm in keeping the geometry column, as data frame operations on <code>sf</code> will only act on the attribute data. For this reason, being good at working with attribute data in geographic data is the same being proficient at handling data frames in R. For many applications, the most effective and intuitive way to work with data frames is with the <strong>dplyr</strong> package.</p>
</div>
<div id="base-vs-data.table-vs-dplyr" class="section level2">
<h2><span class="header-section-number">3.2</span> Base vs data.table vs dplyr</h2>
<p>Simple feature objects of class <code>sf</code> behave exactly the same as <code>data.frame</code> objects for most base R operations. Unlike objects of class <code>Spatial</code> defined by the <strong>sp</strong> package, <code>sf</code> objects are also compatible with <strong>dplyr</strong> and <strong>data.table</strong> packages. This is an advantage because they provide fast functions for data manipulation.</p>
<p>Which method you use is largely a matter of preference. In this chapter the focus is largely on <strong>dplyr</strong> because of it’s intuitive function names and its ability to perform multiple chained operations using the pipe operator. The important thing is that you select a data processing paradigm of choice, and master it.</p>
</div>
<div id="attribute-subsetting" class="section level2">
<h2><span class="header-section-number">3.3</span> Attribute subsetting</h2>
<!-- info about pull (dplyr 0.6): -->
<!-- https://github.com/tidyverse/dplyr/commit/0b9aabf6c06c9cd3b784b155044d497d4b93df3e -->
<p>Every simple feature object of class <code>sf</code> has a <code>data.frame</code> part. Therefore, you can use all of the base R functions for attribute subsetting or apply one of many external packages (such as <code>dplyr</code>) for subset the attributes. Standard functions include <code>[]</code>, <code>$</code>, and <code>subset()</code>. They could be replaced by the <code>dplyr</code> verbs, such as <code>select()</code>, <code>filter()</code>, and <code>pull()</code>. It is important to remember that most of the functions preserve the geometry column.</p>
<p>You can use the <code>[]</code> operator to subset rows and columns. Two arguments are required, one for rows (observations) and one for columns (variables), e.g. [rows, columns]. These arguments could be either numeric, which indicates a position, or character, which indicates a name of row or column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world[<span class="dv">1</span>:<span class="dv">6</span>, ] <span class="co"># subset rows by position</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world[, <span class="dv">1</span>:<span class="dv">3</span>] <span class="co"># subset columns by position</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world[, <span class="kw">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;lifeExp&quot;</span>)] <span class="co"># subset columns by name</span></code></pre></div>
<p>The <code>$</code> operator retrieves a variable by its name and returns a vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world$name_long</code></pre></div>
<p>You can also subset a <code>sf</code> object based on a given condition using (surprise, surprise…) the <code>subset()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">small_countries =<span class="st"> </span><span class="kw">subset</span>(world, area_km2 &lt;<span class="st"> </span><span class="dv">10000</span>)</code></pre></div>
<!-- , after the package has been loaded: [or - it is a part of tidyverse] -->
<p><strong>dplyr</strong> makes working with data frames easier and is compatible with <code>sf</code> objects. The two main <strong>dplyr</strong> functions that help with attribute subsetting are <code>select()</code> and <code>filter()</code>.</p>
<p>The <code>select()</code> function picks columns by its name. For example, you could select only two columns - <code>name_long</code> and <code>pop</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world1 =<span class="st"> </span><span class="kw">select</span>(world, name_long, pop)
<span class="kw">head</span>(world1, <span class="dt">n =</span> <span class="dv">2</span>)
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 11.6401 ymin: -17.93064 xmax: 75.15803 ymax: 38.48628</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;     name_long      pop                           geom</span>
<span class="co">#&gt; 1 Afghanistan 31627506 MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2      Angola 24227524 MULTIPOLYGON(((16.326528354...</span></code></pre></div>
<p>This function gives a possibility to select a range of columns with an <code>:</code> operator or exclude some columns with an <code>-</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># all columns between name_long and pop (inclusive)</span>
world2 =<span class="st"> </span><span class="kw">select</span>(world, name_long:pop)
<span class="kw">head</span>(world2, <span class="dt">n =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># all columns except subregion and area_km2 (inclusive)</span>
world3 =<span class="st"> </span><span class="kw">select</span>(world, -subregion, -area_km2)
<span class="kw">head</span>(world3, <span class="dt">n =</span> <span class="dv">2</span>)</code></pre></div>
<p>The <code>select()</code> function can be also used to both subset and renames columns in a single line, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world4 =<span class="st"> </span><span class="kw">select</span>(world, name_long, <span class="dt">population =</span> pop)
<span class="kw">head</span>(world4, <span class="dt">n =</span> <span class="dv">2</span>)
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 11.6401 ymin: -17.93064 xmax: 75.15803 ymax: 38.48628</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;     name_long population                           geom</span>
<span class="co">#&gt; 1 Afghanistan   31627506 MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2      Angola   24227524 MULTIPOLYGON(((16.326528354...</span></code></pre></div>
<p>This is more concise than the base R equivalent (which saves the result as an object called <code>world5</code> to avoid overriding the <code>world</code> dataset created previously):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world5 =<span class="st"> </span>world[<span class="kw">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;pop&quot;</span>)] <span class="co"># subset columns by name</span>
<span class="kw">names</span>(world5)[<span class="dv">3</span>] =<span class="st"> &quot;population&quot;</span> <span class="co"># rename column manually</span></code></pre></div>
<p>The <code>select()</code> function works with a number of special functions that help with more complicated selection. More details could be find on the function help page - <code>?select</code>.</p>
<p>The <code>filter()</code> function is a <strong>dplyr</strong> alternative to the <code>subset()</code> function. Its role is to keeps rows matching given criteria.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># only countries with a life expectation larger than 82 years</span>
world6 =<span class="st"> </span><span class="kw">filter</span>(world, lifeExp &gt;<span class="st"> </span><span class="dv">82</span>)</code></pre></div>
<p>The standard set of comparison operators can be used in the <code>filter()</code> function: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&amp;</code>, <code>|</code>. <!-- todo - describe these: ==, !=, >, >=, <, <=, &, | --> <!-- more examples --></p>
<p>The <em>pipe</em> operator (<code>%&gt;%</code>), which passes the output of one function into the first argument of the next function, is commonly used in <strong>dplyr</strong> data analysis workflows. This works because the fundamental <strong>dplyr</strong> functions (or ‘verbs’, like <code>select()</code>) all take a data frame object in and spit a data frame object out. Combining many functions together with pipes is called <em>chaining</em> or <em>piping</em>. The advantage over base R for complex data processing operations is that this approach prevents nested functions and is easy to read because there is a clear order and modularity to the work (a piped command can be commented out, for example).</p>
<p>The example below shows yet another way of creating the renamed <code>world</code> dataset, using the pipe operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world7 =<span class="st"> </span>world %&gt;%
<span class="st">  </span><span class="kw">select</span>(name_long, continent)</code></pre></div>
<p>Note that this can also be written without the pipe operator because, in the above code, the <code>world</code> object is simply ‘piped’ into the first argument of <code>select()</code>. The equivalent <strong>dplyr</strong> code without the pipe operator is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world8 =<span class="st"> </span><span class="kw">select</span>(world, name_long, continent)</code></pre></div>
<p>The pipe operator can be used for many data processing tasks with attribute data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1,000,000,000 could be expressed as 1e9 in the scientific notation </span>
world %&gt;%
<span class="st">  </span><span class="kw">filter</span>(pop &gt;<span class="st"> </span><span class="fl">1e9</span>) 
<span class="co">#&gt; Simple feature collection with 2 features and 10 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2 name_long continent region_un     subregion              type</span>
<span class="co">#&gt; 1     CN     China      Asia      Asia  Eastern Asia           Country</span>
<span class="co">#&gt; 2     IN     India      Asia      Asia Southern Asia Sovereign country</span>
<span class="co">#&gt;   area_km2      pop lifeExp gdpPercap                           geom</span>
<span class="co">#&gt; 1  9409832 1.36e+09    75.8     12759 MULTIPOLYGON(((110.33918786...</span>
<span class="co">#&gt; 2  3142892 1.30e+09    68.0      5392 MULTIPOLYGON(((77.837450799...</span></code></pre></div>
<p>This is equivalent to the following base R code (not run to preserve the NAs):<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># subsetting simple feature rows by values</span>
world$pop[<span class="kw">is.na</span>(world$pop)] =<span class="st"> </span><span class="dv">0</span> <span class="co"># set NAs to 0</span>
world_few_rows =<span class="st"> </span>world[world$pop &gt;<span class="st"> </span><span class="fl">1e9</span>,]</code></pre></div>
<p>The <code>%&gt;%</code> operator works the best for combining many operations. For example, we want to (1) rename the <code>name_long</code> column into a <code>name</code> column, (2) picks only <code>name</code>, <code>subregion</code> and <code>gdpPercap</code> and (3) subset countries from “Eastern Asia” with gross domestic product per capita larger than 30,000$:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">name =</span> name_long, subregion, gdpPercap) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(subregion ==<span class="st"> &quot;Eastern Asia&quot;</span>, gdpPercap &gt;<span class="st"> </span><span class="dv">30000</span>)
<span class="co">#&gt; Simple feature collection with 2 features and 3 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;                name    subregion gdpPercap                           geom</span>
<span class="co">#&gt; 1             Japan Eastern Asia     37365 MULTIPOLYGON(((134.63842817...</span>
<span class="co">#&gt; 2 Republic of Korea Eastern Asia     33640 MULTIPOLYGON(((128.34971642...</span></code></pre></div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Exercises</h3>
<!--  -->
</div>
</div>
<div id="attribute-data-aggregation" class="section level2">
<h2><span class="header-section-number">3.4</span> Attribute data aggregation</h2>
<!-- base summary -->
<!-- summarize() function can be used to reduce variables to values -->
<!-- https://github.com/ropenscilabs/skimr ?? -->
<p>The <code>summary()</code> function is used to obtain summary statistics of <code>sf</code> objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data summary </span>
<span class="kw">summary</span>(world)
<span class="co">#&gt;     iso_a2           name_long          continent        </span>
<span class="co">#&gt;  Length:177         Length:177         Length:177        </span>
<span class="co">#&gt;  Class :character   Class :character   Class :character  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Mode  :character  </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;   region_un          subregion             type          </span>
<span class="co">#&gt;  Length:177         Length:177         Length:177        </span>
<span class="co">#&gt;  Class :character   Class :character   Class :character  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Mode  :character  </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;                                                          </span>
<span class="co">#&gt;     area_km2             pop              lifeExp       gdpPercap     </span>
<span class="co">#&gt;  Min.   :    2417   Min.   :5.63e+04   Min.   :48.9   Min.   :   566  </span>
<span class="co">#&gt;  1st Qu.:   46185   1st Qu.:3.86e+06   1st Qu.:64.3   1st Qu.:  3502  </span>
<span class="co">#&gt;  Median :  185004   Median :1.05e+07   Median :72.8   Median : 10740  </span>
<span class="co">#&gt;  Mean   :  832870   Mean   :4.29e+07   Mean   :70.6   Mean   : 17379  </span>
<span class="co">#&gt;  3rd Qu.:  621860   3rd Qu.:3.08e+07   3rd Qu.:77.1   3rd Qu.: 24375  </span>
<span class="co">#&gt;  Max.   :16989128   Max.   :1.36e+09   Max.   :83.6   Max.   :132120  </span>
<span class="co">#&gt;                     NA&#39;s   :9          NA&#39;s   :9      NA&#39;s   :17      </span>
<span class="co">#&gt;             geom    </span>
<span class="co">#&gt;  MULTIPOLYGON :177  </span>
<span class="co">#&gt;  epsg:4326    :  0  </span>
<span class="co">#&gt;  +proj=long...:  0  </span>
<span class="co">#&gt;                     </span>
<span class="co">#&gt;                     </span>
<span class="co">#&gt;                     </span>
<span class="co">#&gt; </span></code></pre></div>
<p>This function works well to get a quick glimpse of data in an interactive mode. The <code>summary()</code> function, hovewer, should not be used to create new objects and is not very customizable. <code>summarise()</code> from the <code>dplyr</code> package can be used as an alternative. In this function, we need to define what kind of statistics and for which variables we want to calculate. For example, we could calculate the world’s population and number of countries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># customized data summary</span>
world_summary =<span class="st"> </span>world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pop =</span> <span class="kw">sum</span>(pop, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">country_n =</span> <span class="kw">n</span>())
world_summary
<span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;        pop country_n                           geom</span>
<span class="co">#&gt; 1 7.21e+09       177 MULTIPOLYGON(((-159.2081835...</span></code></pre></div>
<!-- ?? -->
<!-- ```{r} -->
<!-- plot(world_summary) -->
<!-- ``` -->
<p>The list of helpful functions is in the helpfile of this function - <code>?summarise</code>. The whole power of <code>summarise()</code> is revealed when its combined with the <code>group_by()</code> function. They allow to summary subsets of data. For example, we want to get the total population and number of countries on every continent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data summary by groups</span>
world_continents =<span class="st"> </span>world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(continent) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pop =</span> <span class="kw">sum</span>(pop, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">country_n =</span> <span class="kw">n</span>())
world_continents
<span class="co">#&gt; Simple feature collection with 8 features and 3 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; # A tibble: 8 x 4</span>
<span class="co">#&gt;    continent      pop country_n              geom</span>
<span class="co">#&gt;        &lt;chr&gt;    &lt;dbl&gt;     &lt;int&gt;  &lt;simple_feature&gt;</span>
<span class="co">#&gt; 1     Africa 1.15e+09        51 &lt;MULTIPOLYGON...&gt;</span>
<span class="co">#&gt; 2 Antarctica 0.00e+00         1 &lt;MULTIPOLYGON...&gt;</span>
<span class="co">#&gt; 3       Asia 4.31e+09        47 &lt;MULTIPOLYGON...&gt;</span>
<span class="co">#&gt; 4     Europe 7.39e+08        39 &lt;MULTIPOLYGON...&gt;</span>
<span class="co">#&gt; # ... with 4 more rows</span></code></pre></div>
<!-- ?? -->
<!-- ```{r} -->
<!-- plot(world_continents) -->
<!-- ``` -->
<!-- should it stay or should it go (?) aka should we present the arrange function?: -->
<!-- ```{r} -->
<!-- # sort variables -->
<!-- ## by name -->
<!-- world_continents %>%  -->
<!--   arrange(continent) -->
<!-- ## by population (in descending order) -->
<!-- world_continents %>%  -->
<!--   arrange(-pop) -->
<!-- ``` -->
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Exercises</h3>
</div>
</div>
<div id="attribute-data-joining" class="section level2">
<h2><span class="header-section-number">3.5</span> Attribute data joining</h2>
<!-- https://github.com/dgrtwo/fuzzyjoin -->
<!-- http://r4ds.had.co.nz/relational-data.html -->
<!-- non-unique keys -->
<p>Combining data from different sources is one of the most common task in data preparation. It could be done using joins - methods created to work with a pair of tables. The <strong>dplyr</strong> package has a set of verbs to easily connect <code>data.frames</code> - <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join</code>, <code>semi_join()</code> and <code>anti_join()</code>. They are thoroughly explained in the Relational data chapter in the book R for Data Science <span class="citation">(Grolemund and Wickham <a href="#ref-grolemund_r_2016">2016</a>)</span>.</p>
<p>Working with spatial data, however, usually involves a connection between spatial data (<code>sf</code> objects) and tables (<code>data.frame</code> objects). Fortunately, the <strong>sf</strong> package has all of the <strong>dplyr</strong> join functions adapted to work with <code>sf</code> objects. The only important difference between combining two <code>data.frames</code> and combining <code>sf</code> with <code>data.frame</code> is a <code>geom</code> column. Therefore, the result of data joins could be either an <code>sf</code> or <code>data.frame</code> object.</p>
<p>The easiest way to understand the concept of joins is to use a smaller datasets. We will use an <code>sf</code> object <code>north_america</code> with country codes (<code>iso_a2</code>), names and geometries, as well as <code>data.frame</code> object <code>wb_north_america</code> containing information about urban population and unemployment for three countries. It is important to add that the first object has data about Canada, Greenland and United States and the second one has data about Canada, Mexico and United States:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">north_america =<span class="st"> </span>world %&gt;%
<span class="st">  </span><span class="kw">filter</span>(subregion ==<span class="st"> &quot;Northern America&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(iso_a2, name_long)
north_america
<span class="co">#&gt; Simple feature collection with 3 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long                           geom</span>
<span class="co">#&gt; 1     CA        Canada MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2     GL     Greenland MULTIPOLYGON(((-46.76379 82...</span>
<span class="co">#&gt; 3     US United States MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(north_america[<span class="dv">0</span>])</code></pre></div>
<p><img src="figures/unnamed-chunk-27-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wb_north_america =<span class="st"> </span>worldbank_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(name %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;United States&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(name, iso_a2, urban_pop, <span class="dt">unemploy =</span> unemployment)

wb_north_america
<span class="co">#&gt;            name iso_a2 urban_pop unemploy</span>
<span class="co">#&gt; 1        Canada     CA  29022137     6.91</span>
<span class="co">#&gt; 2        Mexico     MX  99018446     5.25</span>
<span class="co">#&gt; 3 United States     US 259740511     6.17</span></code></pre></div>
<p>In this book, we focus on spatial data. All of the following examples will have a <code>sf</code> object as the first argument and a <code>data.frame</code> object as the second argument. A new <code>sf</code> object will be a result of these joins. However, the reverse order is also possible and will result in a <code>data.frame</code> object. This is beyond the scope of this book, but we encourage you to try it.</p>
<div id="left-joins" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Left joins</h3>
<p>Left join is the most often used type of joins. The <code>left_join()</code> returns all observations from the left object (<code>north_america</code>) and the matched observations from the right object (<code>wb_north_america</code>). In cases, like <code>Greenland</code>, when we don’t have a data in the right object, <code>NA</code> values will be introduced.</p>
<p>To connect two object we need to specify a key. This is a variable (or variables) that uniquely identifies each observation (row). The argument <code>by</code> is used to state which variable is the key. In simple cases, a single, unique variable exist in both objects, for example <code>iso_a2</code> column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">left_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(wb_north_america, <span class="dt">by =</span> <span class="st">&quot;iso_a2&quot;</span>)
left_join1
<span class="co">#&gt; Simple feature collection with 3 features and 5 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -12.20855 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long          name urban_pop unemploy</span>
<span class="co">#&gt; 1     CA        Canada        Canada  29022137     6.91</span>
<span class="co">#&gt; 2     GL     Greenland          &lt;NA&gt;        NA       NA</span>
<span class="co">#&gt; 3     US United States United States 259740511     6.17</span>
<span class="co">#&gt;                             geom</span>
<span class="co">#&gt; 1 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2 MULTIPOLYGON(((-46.76379 82...</span>
<span class="co">#&gt; 3 MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<p>It is also possible to join objects by different variables. Both of the datasets have variables with names of countries, but they are named differently. The <code>north_america</code> has a <code>name_long</code> column and the <code>wb_north_america</code> has a <code>name</code> column. In these cases, we can use a named vector to specify the connection, e.g. <code>c(&quot;name_long&quot; = &quot;name&quot;)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">left_join2 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(wb_north_america, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name_long&quot;</span> =<span class="st"> &quot;name&quot;</span>))
left_join2
<span class="co">#&gt; Simple feature collection with 3 features and 5 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -12.20855 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2.x     name_long iso_a2.y urban_pop unemploy</span>
<span class="co">#&gt; 1       CA        Canada       CA  29022137     6.91</span>
<span class="co">#&gt; 2       GL     Greenland     &lt;NA&gt;        NA       NA</span>
<span class="co">#&gt; 3       US United States       US 259740511     6.17</span>
<span class="co">#&gt;                             geom</span>
<span class="co">#&gt; 1 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2 MULTIPOLYGON(((-46.76379 82...</span>
<span class="co">#&gt; 3 MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<p>The new object <code>left_join2</code>, however is still not perfectly connected as it has two duplicated variables - <code>iso_a2.x</code> and <code>iso_a2.y</code>. To solve this problem we should specify all the keys:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">left_join3 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(wb_north_america, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;iso_a2&quot;</span>, <span class="st">&quot;name_long&quot;</span> =<span class="st"> &quot;name&quot;</span>))
left_join3
<span class="co">#&gt; Simple feature collection with 3 features and 4 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -12.20855 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long urban_pop unemploy                           geom</span>
<span class="co">#&gt; 1     CA        Canada  29022137     6.91 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2     GL     Greenland        NA       NA MULTIPOLYGON(((-46.76379 82...</span>
<span class="co">#&gt; 3     US United States 259740511     6.17 MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<!-- ```{r} -->
<!-- # error: keeps geom col -->
<!-- left_join4 = wb_north_america %>%  -->
<!--   left_join(north_america, by = c("iso_a2")) -->
<!-- left_join4 -->
<!-- ``` -->
</div>
<div id="right-joins" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Right joins</h3>
<p>The <code>right_join()</code> keeps all observations from the right object (<code>wb_north_america</code>), but in the same time preserves a <code>sf</code> class from the left object (<code>north_america</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">right_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">right_join</span>(wb_north_america, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;iso_a2&quot;</span>, <span class="st">&quot;name_long&quot;</span> =<span class="st"> &quot;name&quot;</span>))
right_join1
<span class="co">#&gt; Simple feature collection with 3 features and 4 fields (with 1 geometry empty)</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -52.6481 ymax: 83.23324</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long urban_pop unemploy                           geom</span>
<span class="co">#&gt; 1     CA        Canada  29022137     6.91 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2     MX        Mexico  99018446     5.25                 MULTIPOLYGON()</span>
<span class="co">#&gt; 3     US United States 259740511     6.17 MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<p>You can see that the new object <code>right_join1</code> has information about Mexico, but drop information about Greenland. What’s more, our right object, as a <code>data.frame</code>, doesn’t have a geometry representation of Mexico. As a result, the <code>right_join1</code> object contains only non-spatial data of Mexico. It could be easily illustrated using the <code>plot</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(right_join1[<span class="dv">0</span>]) <span class="co"># Canada and United States only</span></code></pre></div>
<p><img src="figures/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;" /></p>
<!-- ```{r} -->
<!-- # error: unwanted geom column added -->
<!-- right_join2 = wb_north_america %>%  -->
<!--   right_join(north_america, by = "iso_a2") #%>% plot() -->
<!-- right_join2 -->
<!-- ``` -->
</div>
<div id="inner-joins" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Inner joins</h3>
<p>The <code>inner_join()</code> keeps only observations from the left object (<code>north_america</code>) where there are matching observations in the right object (<code>wb_north_america</code>). Additionally, all columns from the left and right object are kept:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inner_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(wb_north_america, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;iso_a2&quot;</span>, <span class="st">&quot;name_long&quot;</span> =<span class="st"> &quot;name&quot;</span>))
inner_join1
<span class="co">#&gt; Simple feature collection with 2 features and 4 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -52.6481 ymax: 83.23324</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long urban_pop unemploy                           geom</span>
<span class="co">#&gt; 1     CA        Canada  29022137     6.91 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2     US United States 259740511     6.17 MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<!-- ```{r} -->
<!-- # error: geom column added -->
<!-- inner_join2 =  wb_north_america %>%  -->
<!--   inner_join(north_america, by = "iso_a2")  -->
<!-- inner_join2 -->
<!-- ``` -->
</div>
<div id="semi-joins" class="section level3">
<h3><span class="header-section-number">3.5.4</span> Semi joins</h3>
<p>The <code>semi_join()</code> is very similar to the <code>inner_join()</code>. It also keeps only observations from the left object (<code>north_america</code>) where there are matching observations in the right object, but keeping just columns from the left one: <!-- filtering? --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">semi_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">semi_join</span>(wb_north_america, <span class="dt">by =</span> <span class="st">&quot;iso_a2&quot;</span>)
semi_join1
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -52.6481 ymax: 83.23324</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long                           geom</span>
<span class="co">#&gt; 1     CA        Canada MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2     US United States MULTIPOLYGON(((-155.54211 1...</span></code></pre></div>
<!-- ```{r} -->
<!-- semi_join2 = wb_north_america %>% -->
<!--   semi_join(north_america, by = "iso_a2") -->
<!-- semi_join2 -->
<!-- ``` -->
</div>
<div id="anti-joins" class="section level3">
<h3><span class="header-section-number">3.5.5</span> Anti joins</h3>
<p>The <code>anti_join()</code> returns all rows from the left object that are not matching observations in the right object. Only columns from the right object are kept:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anti_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(wb_north_america, <span class="dt">by =</span> <span class="st">&quot;iso_a2&quot;</span>)
anti_join1
<span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -73.297 ymin: 60.03676 xmax: -12.20855 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2 name_long                           geom</span>
<span class="co">#&gt; 1     GL Greenland MULTIPOLYGON(((-46.76379 82...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(anti_join1[<span class="dv">0</span>])</code></pre></div>
<p><img src="figures/unnamed-chunk-37-1.png" width="576" style="display: block; margin: auto;" /></p>
<!-- ```{r} -->
<!-- anti_join2 = wb_north_america %>%  -->
<!--   anti_join(north_america, by = "iso_a2") -->
<!-- anti_join2 -->
<!-- ``` -->
</div>
<div id="full-joins" class="section level3">
<h3><span class="header-section-number">3.5.6</span> Full joins</h3>
<p>The <code>full_join()</code> returns all rows and all columns from both the left and right object. It also puts <code>NA</code> in cases where there are not matching values and returns an empty geometry for cases that only exist in the right object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full_join1 =<span class="st"> </span>north_america %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">full_join</span>(wb_north_america, <span class="dt">by =</span> <span class="st">&quot;iso_a2&quot;</span>)
full_join1
<span class="co">#&gt; Simple feature collection with 4 features and 5 fields (with 1 geometry empty)</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -171.7911 ymin: 18.91619 xmax: -12.20855 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   iso_a2     name_long          name urban_pop unemploy</span>
<span class="co">#&gt; 1     CA        Canada        Canada  29022137     6.91</span>
<span class="co">#&gt; 2     GL     Greenland          &lt;NA&gt;        NA       NA</span>
<span class="co">#&gt; 3     US United States United States 259740511     6.17</span>
<span class="co">#&gt; 4     MX          &lt;NA&gt;        Mexico  99018446     5.25</span>
<span class="co">#&gt;                             geom</span>
<span class="co">#&gt; 1 MULTIPOLYGON(((-63.6645 46....</span>
<span class="co">#&gt; 2 MULTIPOLYGON(((-46.76379 82...</span>
<span class="co">#&gt; 3 MULTIPOLYGON(((-155.54211 1...</span>
<span class="co">#&gt; 4                 MULTIPOLYGON()</span></code></pre></div>
<!-- ```{r} -->
<!-- # error: null geom -->
<!-- full_join2 = wb_north_america %>%  -->
<!--   full_join(north_america, by = "iso_a2") #%>% plot() -->
<!-- full_join2 -->
<!-- ``` -->
</div>
<div id="exercises-4" class="section level3">
<h3><span class="header-section-number">3.5.7</span> Exercises</h3>
<!-- -->
</div>
</div>
<div id="attribute-data-creation" class="section level2">
<h2><span class="header-section-number">3.6</span> Attribute data creation</h2>
<p>It is often the case when a new column needs to be created based on existing columns. For example, we want to calculate population density. We need to divide a <code>pop</code> column (population) by a <code>area_km2</code> column (unit area in square km). In base R it could be done this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world_new &lt;-<span class="st"> </span>world <span class="co"># not to overwrite our original data</span>
world_new$pop_dens =<span class="st"> </span>world_new$pop /<span class="st"> </span>world_new$area_km2</code></pre></div>
<p>Alternatively, we can use one of <strong>dplyr</strong> functions - <code>mutate()</code> or <code>transmute()</code>. <code>mutate()</code> adds new columns at second-to-last position in the <code>sf</code> object (the last one is reserved for the geometry):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop_dens =</span> pop /<span class="st"> </span>area_km2)
<span class="co">#&gt; Simple feature collection with 177 features and 11 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; First 20 features:</span>
<span class="co">#&gt;    iso_a2                           name_long               continent</span>
<span class="co">#&gt; 1      AF                         Afghanistan                    Asia</span>
<span class="co">#&gt; 2      AO                              Angola                  Africa</span>
<span class="co">#&gt; 3      AL                             Albania                  Europe</span>
<span class="co">#&gt; 4      AE                United Arab Emirates                    Asia</span>
<span class="co">#&gt; 5      AR                           Argentina           South America</span>
<span class="co">#&gt; 6      AM                             Armenia                    Asia</span>
<span class="co">#&gt; 7      AQ                          Antarctica              Antarctica</span>
<span class="co">#&gt; 8      TF French Southern and Antarctic Lands Seven seas (open ocean)</span>
<span class="co">#&gt; 9      AU                           Australia                 Oceania</span>
<span class="co">#&gt; 10     AT                             Austria                  Europe</span>
<span class="co">#&gt; 11     AZ                          Azerbaijan                    Asia</span>
<span class="co">#&gt; 12     BI                             Burundi                  Africa</span>
<span class="co">#&gt; 13     BE                             Belgium                  Europe</span>
<span class="co">#&gt; 14     BJ                               Benin                  Africa</span>
<span class="co">#&gt; 15     BF                        Burkina Faso                  Africa</span>
<span class="co">#&gt; 16     BD                          Bangladesh                    Asia</span>
<span class="co">#&gt; 17     BG                            Bulgaria                  Europe</span>
<span class="co">#&gt; 18     BS                             Bahamas           North America</span>
<span class="co">#&gt; 19     BA              Bosnia and Herzegovina                  Europe</span>
<span class="co">#&gt; 20     BY                             Belarus                  Europe</span>
<span class="co">#&gt;                  region_un                 subregion              type</span>
<span class="co">#&gt; 1                     Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 2                   Africa             Middle Africa Sovereign country</span>
<span class="co">#&gt; 3                   Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 4                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 5                 Americas             South America Sovereign country</span>
<span class="co">#&gt; 6                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 7               Antarctica                Antarctica     Indeterminate</span>
<span class="co">#&gt; 8  Seven seas (open ocean)   Seven seas (open ocean)        Dependency</span>
<span class="co">#&gt; 9                  Oceania Australia and New Zealand           Country</span>
<span class="co">#&gt; 10                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 11                    Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 12                  Africa            Eastern Africa Sovereign country</span>
<span class="co">#&gt; 13                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 14                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 15                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 16                    Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 17                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt; 18                Americas                 Caribbean Sovereign country</span>
<span class="co">#&gt; 19                  Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 20                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt;    area_km2      pop lifeExp gdpPercap pop_dens</span>
<span class="co">#&gt; 1    652270 3.16e+07    60.4      1844    48.49</span>
<span class="co">#&gt; 2   1245464 2.42e+07    52.3      6956    19.45</span>
<span class="co">#&gt; 3     29695 2.89e+06    77.8     10699    97.45</span>
<span class="co">#&gt; 4     79881 9.09e+06    77.4     63831   113.75</span>
<span class="co">#&gt; 5   2784469 4.30e+07    76.2     18873    15.44</span>
<span class="co">#&gt; 6     28657 3.01e+06    74.7      7706   104.90</span>
<span class="co">#&gt; 7  12335956       NA      NA        NA       NA</span>
<span class="co">#&gt; 8     11603       NA      NA        NA       NA</span>
<span class="co">#&gt; 9   7687614 2.35e+07    82.3     43274     3.05</span>
<span class="co">#&gt; 10    85065 8.54e+06    81.3     44123   100.41</span>
<span class="co">#&gt; 11    91113 9.54e+06    70.8     16715   104.65</span>
<span class="co">#&gt; 12    26239 1.08e+07    56.7       734   412.24</span>
<span class="co">#&gt; 13    30126 1.12e+07    80.6     41274   372.81</span>
<span class="co">#&gt; 14   116999 1.06e+07    59.5      1942    90.59</span>
<span class="co">#&gt; 15   271594 1.76e+07    58.6      1576    64.76</span>
<span class="co">#&gt; 16   133782 1.59e+08    71.6      2979  1189.08</span>
<span class="co">#&gt; 17   110217 7.22e+06    75.4     16302    65.54</span>
<span class="co">#&gt; 18    15585 3.83e+05    75.2     22253    24.58</span>
<span class="co">#&gt; 19    50605 3.82e+06    76.4      9802    75.44</span>
<span class="co">#&gt; 20   208970 9.48e+06    73.0     17364    45.38</span>
<span class="co">#&gt;                              geom</span>
<span class="co">#&gt; 1  MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2  MULTIPOLYGON(((16.326528354...</span>
<span class="co">#&gt; 3  MULTIPOLYGON(((20.590247430...</span>
<span class="co">#&gt; 4  MULTIPOLYGON(((51.579518670...</span>
<span class="co">#&gt; 5  MULTIPOLYGON(((-65.5 -55.2,...</span>
<span class="co">#&gt; 6  MULTIPOLYGON(((43.582745802...</span>
<span class="co">#&gt; 7  MULTIPOLYGON(((-59.57209469...</span>
<span class="co">#&gt; 8  MULTIPOLYGON(((68.935 -48.6...</span>
<span class="co">#&gt; 9  MULTIPOLYGON(((145.39797814...</span>
<span class="co">#&gt; 10 MULTIPOLYGON(((16.979666782...</span>
<span class="co">#&gt; 11 MULTIPOLYGON(((45.001987339...</span>
<span class="co">#&gt; 12 MULTIPOLYGON(((29.339997592...</span>
<span class="co">#&gt; 13 MULTIPOLYGON(((3.3149711442...</span>
<span class="co">#&gt; 14 MULTIPOLYGON(((2.6917016943...</span>
<span class="co">#&gt; 15 MULTIPOLYGON(((-2.827496303...</span>
<span class="co">#&gt; 16 MULTIPOLYGON(((92.672720981...</span>
<span class="co">#&gt; 17 MULTIPOLYGON(((22.657149692...</span>
<span class="co">#&gt; 18 MULTIPOLYGON(((-77.53466 23...</span>
<span class="co">#&gt; 19 MULTIPOLYGON(((19.005486281...</span>
<span class="co">#&gt; 20 MULTIPOLYGON(((23.484127638...</span></code></pre></div>
<p>The difference between <code>mutate()</code> and <code>transmute()</code> is that the latter do not preserve existing columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">pop_dens =</span> pop /<span class="st"> </span>area_km2)
<span class="co">#&gt; Simple feature collection with 177 features and 1 field</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; First 20 features:</span>
<span class="co">#&gt;    pop_dens                           geom</span>
<span class="co">#&gt; 1     48.49 MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2     19.45 MULTIPOLYGON(((16.326528354...</span>
<span class="co">#&gt; 3     97.45 MULTIPOLYGON(((20.590247430...</span>
<span class="co">#&gt; 4    113.75 MULTIPOLYGON(((51.579518670...</span>
<span class="co">#&gt; 5     15.44 MULTIPOLYGON(((-65.5 -55.2,...</span>
<span class="co">#&gt; 6    104.90 MULTIPOLYGON(((43.582745802...</span>
<span class="co">#&gt; 7        NA MULTIPOLYGON(((-59.57209469...</span>
<span class="co">#&gt; 8        NA MULTIPOLYGON(((68.935 -48.6...</span>
<span class="co">#&gt; 9      3.05 MULTIPOLYGON(((145.39797814...</span>
<span class="co">#&gt; 10   100.41 MULTIPOLYGON(((16.979666782...</span>
<span class="co">#&gt; 11   104.65 MULTIPOLYGON(((45.001987339...</span>
<span class="co">#&gt; 12   412.24 MULTIPOLYGON(((29.339997592...</span>
<span class="co">#&gt; 13   372.81 MULTIPOLYGON(((3.3149711442...</span>
<span class="co">#&gt; 14    90.59 MULTIPOLYGON(((2.6917016943...</span>
<span class="co">#&gt; 15    64.76 MULTIPOLYGON(((-2.827496303...</span>
<span class="co">#&gt; 16  1189.08 MULTIPOLYGON(((92.672720981...</span>
<span class="co">#&gt; 17    65.54 MULTIPOLYGON(((22.657149692...</span>
<span class="co">#&gt; 18    24.58 MULTIPOLYGON(((-77.53466 23...</span>
<span class="co">#&gt; 19    75.44 MULTIPOLYGON(((19.005486281...</span>
<span class="co">#&gt; 20    45.38 MULTIPOLYGON(((23.484127638...</span></code></pre></div>
<!-- unite ?? -->
<!-- https://github.com/edzer/sfr/issues/378 -->
<!-- ```{r} -->
<!-- world %>%  -->
<!--   unite(con_reg, continent:region_un, sep = ":") -->
<!-- ``` -->
<!-- separate -->
<!-- rename -->
<p>Two helper functions, <code>rename()</code> and <code>set_names</code> can be used to change columns names. The first one, <code>rename()</code> replace an old name with a new one. For example, we want to change a name of column from <code>name_long</code> to <code>name</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">name =</span> name_long)
<span class="co">#&gt; Simple feature collection with 177 features and 10 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; First 20 features:</span>
<span class="co">#&gt;    iso_a2                                name               continent</span>
<span class="co">#&gt; 1      AF                         Afghanistan                    Asia</span>
<span class="co">#&gt; 2      AO                              Angola                  Africa</span>
<span class="co">#&gt; 3      AL                             Albania                  Europe</span>
<span class="co">#&gt; 4      AE                United Arab Emirates                    Asia</span>
<span class="co">#&gt; 5      AR                           Argentina           South America</span>
<span class="co">#&gt; 6      AM                             Armenia                    Asia</span>
<span class="co">#&gt; 7      AQ                          Antarctica              Antarctica</span>
<span class="co">#&gt; 8      TF French Southern and Antarctic Lands Seven seas (open ocean)</span>
<span class="co">#&gt; 9      AU                           Australia                 Oceania</span>
<span class="co">#&gt; 10     AT                             Austria                  Europe</span>
<span class="co">#&gt; 11     AZ                          Azerbaijan                    Asia</span>
<span class="co">#&gt; 12     BI                             Burundi                  Africa</span>
<span class="co">#&gt; 13     BE                             Belgium                  Europe</span>
<span class="co">#&gt; 14     BJ                               Benin                  Africa</span>
<span class="co">#&gt; 15     BF                        Burkina Faso                  Africa</span>
<span class="co">#&gt; 16     BD                          Bangladesh                    Asia</span>
<span class="co">#&gt; 17     BG                            Bulgaria                  Europe</span>
<span class="co">#&gt; 18     BS                             Bahamas           North America</span>
<span class="co">#&gt; 19     BA              Bosnia and Herzegovina                  Europe</span>
<span class="co">#&gt; 20     BY                             Belarus                  Europe</span>
<span class="co">#&gt;                  region_un                 subregion              type</span>
<span class="co">#&gt; 1                     Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 2                   Africa             Middle Africa Sovereign country</span>
<span class="co">#&gt; 3                   Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 4                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 5                 Americas             South America Sovereign country</span>
<span class="co">#&gt; 6                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 7               Antarctica                Antarctica     Indeterminate</span>
<span class="co">#&gt; 8  Seven seas (open ocean)   Seven seas (open ocean)        Dependency</span>
<span class="co">#&gt; 9                  Oceania Australia and New Zealand           Country</span>
<span class="co">#&gt; 10                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 11                    Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 12                  Africa            Eastern Africa Sovereign country</span>
<span class="co">#&gt; 13                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 14                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 15                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 16                    Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 17                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt; 18                Americas                 Caribbean Sovereign country</span>
<span class="co">#&gt; 19                  Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 20                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt;    area_km2      pop lifeExp gdpPercap                           geom</span>
<span class="co">#&gt; 1    652270 3.16e+07    60.4      1844 MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2   1245464 2.42e+07    52.3      6956 MULTIPOLYGON(((16.326528354...</span>
<span class="co">#&gt; 3     29695 2.89e+06    77.8     10699 MULTIPOLYGON(((20.590247430...</span>
<span class="co">#&gt; 4     79881 9.09e+06    77.4     63831 MULTIPOLYGON(((51.579518670...</span>
<span class="co">#&gt; 5   2784469 4.30e+07    76.2     18873 MULTIPOLYGON(((-65.5 -55.2,...</span>
<span class="co">#&gt; 6     28657 3.01e+06    74.7      7706 MULTIPOLYGON(((43.582745802...</span>
<span class="co">#&gt; 7  12335956       NA      NA        NA MULTIPOLYGON(((-59.57209469...</span>
<span class="co">#&gt; 8     11603       NA      NA        NA MULTIPOLYGON(((68.935 -48.6...</span>
<span class="co">#&gt; 9   7687614 2.35e+07    82.3     43274 MULTIPOLYGON(((145.39797814...</span>
<span class="co">#&gt; 10    85065 8.54e+06    81.3     44123 MULTIPOLYGON(((16.979666782...</span>
<span class="co">#&gt; 11    91113 9.54e+06    70.8     16715 MULTIPOLYGON(((45.001987339...</span>
<span class="co">#&gt; 12    26239 1.08e+07    56.7       734 MULTIPOLYGON(((29.339997592...</span>
<span class="co">#&gt; 13    30126 1.12e+07    80.6     41274 MULTIPOLYGON(((3.3149711442...</span>
<span class="co">#&gt; 14   116999 1.06e+07    59.5      1942 MULTIPOLYGON(((2.6917016943...</span>
<span class="co">#&gt; 15   271594 1.76e+07    58.6      1576 MULTIPOLYGON(((-2.827496303...</span>
<span class="co">#&gt; 16   133782 1.59e+08    71.6      2979 MULTIPOLYGON(((92.672720981...</span>
<span class="co">#&gt; 17   110217 7.22e+06    75.4     16302 MULTIPOLYGON(((22.657149692...</span>
<span class="co">#&gt; 18    15585 3.83e+05    75.2     22253 MULTIPOLYGON(((-77.53466 23...</span>
<span class="co">#&gt; 19    50605 3.82e+06    76.4      9802 MULTIPOLYGON(((19.005486281...</span>
<span class="co">#&gt; 20   208970 9.48e+06    73.0     17364 MULTIPOLYGON(((23.484127638...</span></code></pre></div>
<p><code>set_names</code> can be used to change names of many columns. In this function, we do not need to provide old names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ISO_A2&quot;</span>, <span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Continent&quot;</span>, <span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Subregion&quot;</span>, 
              <span class="st">&quot;Country_type&quot;</span>, <span class="st">&quot;Area_in_km2&quot;</span>, <span class="st">&quot;Population&quot;</span>, <span class="st">&quot;Life_Expectancy&quot;</span>,
              <span class="st">&quot;GDP_per_capita&quot;</span>, <span class="st">&quot;geom&quot;</span>)
world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">set_names</span>(new_names)
<span class="co">#&gt; Simple feature collection with 177 features and 10 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; First 20 features:</span>
<span class="co">#&gt;    ISO_A2                                Name               Continent</span>
<span class="co">#&gt; 1      AF                         Afghanistan                    Asia</span>
<span class="co">#&gt; 2      AO                              Angola                  Africa</span>
<span class="co">#&gt; 3      AL                             Albania                  Europe</span>
<span class="co">#&gt; 4      AE                United Arab Emirates                    Asia</span>
<span class="co">#&gt; 5      AR                           Argentina           South America</span>
<span class="co">#&gt; 6      AM                             Armenia                    Asia</span>
<span class="co">#&gt; 7      AQ                          Antarctica              Antarctica</span>
<span class="co">#&gt; 8      TF French Southern and Antarctic Lands Seven seas (open ocean)</span>
<span class="co">#&gt; 9      AU                           Australia                 Oceania</span>
<span class="co">#&gt; 10     AT                             Austria                  Europe</span>
<span class="co">#&gt; 11     AZ                          Azerbaijan                    Asia</span>
<span class="co">#&gt; 12     BI                             Burundi                  Africa</span>
<span class="co">#&gt; 13     BE                             Belgium                  Europe</span>
<span class="co">#&gt; 14     BJ                               Benin                  Africa</span>
<span class="co">#&gt; 15     BF                        Burkina Faso                  Africa</span>
<span class="co">#&gt; 16     BD                          Bangladesh                    Asia</span>
<span class="co">#&gt; 17     BG                            Bulgaria                  Europe</span>
<span class="co">#&gt; 18     BS                             Bahamas           North America</span>
<span class="co">#&gt; 19     BA              Bosnia and Herzegovina                  Europe</span>
<span class="co">#&gt; 20     BY                             Belarus                  Europe</span>
<span class="co">#&gt;                     Region                 Subregion      Country_type</span>
<span class="co">#&gt; 1                     Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 2                   Africa             Middle Africa Sovereign country</span>
<span class="co">#&gt; 3                   Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 4                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 5                 Americas             South America Sovereign country</span>
<span class="co">#&gt; 6                     Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 7               Antarctica                Antarctica     Indeterminate</span>
<span class="co">#&gt; 8  Seven seas (open ocean)   Seven seas (open ocean)        Dependency</span>
<span class="co">#&gt; 9                  Oceania Australia and New Zealand           Country</span>
<span class="co">#&gt; 10                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 11                    Asia              Western Asia Sovereign country</span>
<span class="co">#&gt; 12                  Africa            Eastern Africa Sovereign country</span>
<span class="co">#&gt; 13                  Europe            Western Europe Sovereign country</span>
<span class="co">#&gt; 14                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 15                  Africa            Western Africa Sovereign country</span>
<span class="co">#&gt; 16                    Asia             Southern Asia Sovereign country</span>
<span class="co">#&gt; 17                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt; 18                Americas                 Caribbean Sovereign country</span>
<span class="co">#&gt; 19                  Europe           Southern Europe Sovereign country</span>
<span class="co">#&gt; 20                  Europe            Eastern Europe Sovereign country</span>
<span class="co">#&gt;    Area_in_km2 Population Life_Expectancy GDP_per_capita</span>
<span class="co">#&gt; 1       652270   3.16e+07            60.4           1844</span>
<span class="co">#&gt; 2      1245464   2.42e+07            52.3           6956</span>
<span class="co">#&gt; 3        29695   2.89e+06            77.8          10699</span>
<span class="co">#&gt; 4        79881   9.09e+06            77.4          63831</span>
<span class="co">#&gt; 5      2784469   4.30e+07            76.2          18873</span>
<span class="co">#&gt; 6        28657   3.01e+06            74.7           7706</span>
<span class="co">#&gt; 7     12335956         NA              NA             NA</span>
<span class="co">#&gt; 8        11603         NA              NA             NA</span>
<span class="co">#&gt; 9      7687614   2.35e+07            82.3          43274</span>
<span class="co">#&gt; 10       85065   8.54e+06            81.3          44123</span>
<span class="co">#&gt; 11       91113   9.54e+06            70.8          16715</span>
<span class="co">#&gt; 12       26239   1.08e+07            56.7            734</span>
<span class="co">#&gt; 13       30126   1.12e+07            80.6          41274</span>
<span class="co">#&gt; 14      116999   1.06e+07            59.5           1942</span>
<span class="co">#&gt; 15      271594   1.76e+07            58.6           1576</span>
<span class="co">#&gt; 16      133782   1.59e+08            71.6           2979</span>
<span class="co">#&gt; 17      110217   7.22e+06            75.4          16302</span>
<span class="co">#&gt; 18       15585   3.83e+05            75.2          22253</span>
<span class="co">#&gt; 19       50605   3.82e+06            76.4           9802</span>
<span class="co">#&gt; 20      208970   9.48e+06            73.0          17364</span>
<span class="co">#&gt;                              geom</span>
<span class="co">#&gt; 1  MULTIPOLYGON(((61.210817091...</span>
<span class="co">#&gt; 2  MULTIPOLYGON(((16.326528354...</span>
<span class="co">#&gt; 3  MULTIPOLYGON(((20.590247430...</span>
<span class="co">#&gt; 4  MULTIPOLYGON(((51.579518670...</span>
<span class="co">#&gt; 5  MULTIPOLYGON(((-65.5 -55.2,...</span>
<span class="co">#&gt; 6  MULTIPOLYGON(((43.582745802...</span>
<span class="co">#&gt; 7  MULTIPOLYGON(((-59.57209469...</span>
<span class="co">#&gt; 8  MULTIPOLYGON(((68.935 -48.6...</span>
<span class="co">#&gt; 9  MULTIPOLYGON(((145.39797814...</span>
<span class="co">#&gt; 10 MULTIPOLYGON(((16.979666782...</span>
<span class="co">#&gt; 11 MULTIPOLYGON(((45.001987339...</span>
<span class="co">#&gt; 12 MULTIPOLYGON(((29.339997592...</span>
<span class="co">#&gt; 13 MULTIPOLYGON(((3.3149711442...</span>
<span class="co">#&gt; 14 MULTIPOLYGON(((2.6917016943...</span>
<span class="co">#&gt; 15 MULTIPOLYGON(((-2.827496303...</span>
<span class="co">#&gt; 16 MULTIPOLYGON(((92.672720981...</span>
<span class="co">#&gt; 17 MULTIPOLYGON(((22.657149692...</span>
<span class="co">#&gt; 18 MULTIPOLYGON(((-77.53466 23...</span>
<span class="co">#&gt; 19 MULTIPOLYGON(((19.005486281...</span>
<span class="co">#&gt; 20 MULTIPOLYGON(((23.484127638...</span></code></pre></div>
<!-- lubridate? -->
<div id="exercises-5" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Exercises</h3>
<!-- calculate gdp -->
</div>
</div>
<div id="removing-spatial-information" class="section level2">
<h2><span class="header-section-number">3.7</span> Removing spatial information</h2>
<p>Most of the function from <strong>sf</strong> package do not drop a <code>geometry</code> column. To extract a data frame <code>st_geometry()</code> or <code>st_set_geometry()</code> function can be used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world_st =<span class="st"> </span>world
<span class="kw">st_geometry</span>(world_st) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">class</span>(world_st)
<span class="co">#&gt; [1] &quot;data.frame&quot;</span>

<span class="co"># OR</span>

world_st2 =<span class="st"> </span>world
world_st2 =<span class="st"> </span>world_st2 %&gt;%<span class="st"> </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>)
<span class="kw">class</span>(world_st2)
<span class="co">#&gt; [1] &quot;data.frame&quot;</span></code></pre></div>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-grolemund_r_2016">
<p>Grolemund, Garrett, and Hadley Wickham. 2016. <em>R for Data Science</em>. 1 edition. O’Reilly Media.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p><a href="https://github.com/Robinlovelace/geocompr/issues/28">Note</a> NAs do not work for subsetting by inequalities in base R, hence conversion of NAs to 0s in this version)<a href="attr.html#fnref4">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-class.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-data-operations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Robinlovelace/geocompr/edit/master/03-attribute-operations.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
